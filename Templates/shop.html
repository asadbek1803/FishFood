{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .category-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 30px;
    }
    
    .btn-filter {
        padding: 8px 20px;
        background: var(--dark-bg);
        border: 1px solid rgba(96, 213, 244, 0.2);
        color: white;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-filter:hover,
    .btn-filter.active {
        background: var(--primary-color);
        color: var(--dark-bg);
        border-color: var(--primary-color);
    }
    
    .product-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: #ff4444;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        font-weight: bold;
        z-index: 1;
    }
    
    .product-category {
        color: var(--primary-color);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
    }
    
    .product-price-container {
        margin: 10px 0;
    }
    
    .product-price-old {
        text-decoration: line-through;
        color: rgba(255, 255, 255, 0.5);
        font-size: 14px;
    }
    
    .product-price-new {
        color: var(--primary-color);
        font-size: 24px;
        font-weight: bold;
    }

    .product-price {
        color: var(--primary-color);
        font-size: 20px;
        font-weight: bold;
    }
    
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: rgba(255, 255, 255, 0.6);
    }
    
    .empty-state i {
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    .quantity-control {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin: 15px 0;
    }

    .quantity-control input {
        width: 60px;
        text-align: center;
        padding: 8px;
        background: var(--darker-bg);
        border: 1px solid var(--primary-color);
        color: white;
        border-radius: 5px;
    }

    .quantity-control button {
        width: 35px;
        height: 35px;
        border: 1px solid var(--primary-color);
        background: var(--darker-bg);
        color: var(--primary-color);
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }

    .quantity-control button:hover {
        background: var(--primary-color);
        color: var(--dark-bg);
    }
</style>


<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <h1><i class="fas fa-store"></i> Bizning Do'konimiz</h1>
        <p>Eng sifatli dengiz mahsulotlarini tanlang</p>
    </div>
</div>

<!-- Shop Section -->
<section class="shop-section">
    <div class="container">
        <!-- Category Filter -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="category-filter">
                    <button class="btn-filter active" data-category="all">Hammasi</button>
                    {% for category in categories %}
                    <button class="btn-filter" data-category="{{ category.id }}">{{ category.name }}</button>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Products Grid -->
<div class="row" id="productsGrid">
    {% for product in products %}
    <div class="col-md-4 col-lg-3 mb-4 product-item" data-category="{{ product.category.id }}">
        
        <div class="product-card"
             data-product-id="{{ product.id }}"
             data-product-name="{{ product.name }}"
             data-product-price="{% if product.stock and product.get_price_action_percent > 0 %}{{ product.stock }}{% else %}{{ product.price }}{% endif %}">
            
            <!-- Product Image -->
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
                <img src="https://images.unsplash.com/photo-1574781330855-d0db8cc6a79c?w=400&h=300&fit=crop" alt="{{ product.name }}" class="product-image">
            {% endif %}
            
            <!-- Discount Badge -->
            {% if product.stock and product.get_price_action_percent > 0 %}
                <div class="product-badge">
                    {{ product.get_price_action_percent|floatformat:0 }}% chegirma
                </div>
            {% endif %}
            
            <div class="product-info">
                
                <div class="product-category">{{ product.category.name }}</div>
                
                <h3 class="product-name">{{ product.name }}</h3>
                
                <p class="product-description">
                    {{ product.description|truncatechars:60 }}
                </p>
                
                <!-- Prices -->
                <div class="product-price-container">
                    {% if product.stock and product.get_price_action_percent > 0 %}
                        <div class="product-price-old">
                            {{ product.old_price|floatformat:0 }} so'm
                        </div>
                        <div class="product-price-new">
                            {{ product.price|floatformat:0 }} so'm/kg
                        </div>
                        <br>
                        <div>
                            <strong>Qolgan mahsulotlar soni/kg: {{product.stock}} </strong> 
                        </div>
                    {% else %}
                        <div class="product-price">
                            {{ product.price|floatformat:0 }} so'm/kg
                        </div>
                        <div>
                            <strong>Qolgan mahsulotlar soni/kg: {{product.stock}}</strong> 
                        </div>
                    {% endif %}
                </div>
                
                <!-- Quantity -->
                <div class="quantity-control">
                    <button type="button" class="decrease-btn" data-id="{{ product.id }}">-</button>
                    <input type="number" id="quantity_{{ product.id }}" value="1" min="0.5" step="0.5" readonly>
                    <button type="button" class="increase-btn" data-id="{{ product.id }}">+</button>
                </div>
                
                <!-- Add to Cart -->
                <button class="btn-add-cart add-to-cart-btn" data-id="{{ product.id }}">
                    <i class="fas fa-cart-plus"></i> Savatga qo'shish
                </button>
            </div>
        </div>
        
    </div>
    {% empty %}
    <div class="col-12">
        <div class="empty-state">
            <i class="fas fa-fish fa-4x"></i>
            <h3>Mahsulotlar topilmadi</h3>
            <p>Tez orada yangi mahsulotlar qo'shiladi</p>
        </div>
    </div>
    {% endfor %}
</div>

</section>

<!-- Cart Icon -->
<div class="cart-icon" id="cartIcon">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-badge" id="cartBadge">0</span>
</div>

<!-- Cart Modal -->
<div class="order-modal" id="cartModal">
    <div class="order-content">
        <h3><i class="fas fa-shopping-cart"></i> Savatingiz</h3>
        <div id="cartItems">
            <!-- Cart items will appear here -->
        </div>
        <div class="cart-summary">
            <div class="total-price">
                Jami: <span id="cartTotal">0</span> so'm
            </div>
            <button class="btn-submit" id="checkoutBtn">
                <i class="fas fa-check"></i> Buyurtma berish
            </button>
            <button class="btn-close-modal" id="closeCartBtn">
                <i class="fas fa-times"></i> Yopish
            </button>
        </div>
    </div>
</div>

<script src="{% static 'shop.js' %}"></script>
{% endblock %}

